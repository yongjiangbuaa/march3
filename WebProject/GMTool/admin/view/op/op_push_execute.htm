<!--{template header}--><div class="alert alert-info"><?php echo "单人推送：";?></div><input type="radio" id="manage" name="keyType" value="manage" onclick="changeType()" <!--{if !$deviceToken}-->checked<!--{/if}--> /> 查看已推送<input type="radio" id="add" name="keyType" value="add" onclick="changeType()" <!--{if $deviceToken}-->checked<!--{/if}-->/> 发送单人推送<div id="manageDiv" <!--{if $deviceToken}-->style="display:none"<!--{/if}-->>	<div id='show' style="width:100%;float:left;height:450px;">		<!--<button type="button" class="btn btn-info" name="btn_set" onclick="getData(1)">查看</button>-->		<!--{if $dbData }-->		<table class="listTable" cellspacing=1 padding=0 style="width: 100%; text-align: center;">			<tr class="listTr">				<th width=2%>玩家id</th>				<th width=10%>内容</th>				<th width=4%>预计发送时间</th>				<th width=2%>发送状态</th>				<th width=2%></th>			</tr>			<!--{loop $dbData $key $value}-->			<tr class="listTr" onMouseOver="this.style.background='#ffff99'"				onMouseOut="this.style.background='#fff';">				<!--{if $value['state'] !=3}-->				<td width="2%">$value['userid']</td>				<td width="2%">$value['contents']</td>				<td width="2%">$value['startTime']</td>				<td width="2%">$value['stateMsg']</td>				<!--{else}-->				<td width="2%" id="$value['uid']_userid"><a href="javascript:void(edit('{$value['uid']}_userid','{$value['userid']}'))">$value['userid']</a></td>				<td width="2%" id="$value['uid']_contents"><a href="javascript:void(edit('{$value['uid']}_contents','{$value['contents']}'))">$value['contents']</a></td>				<td width="2%" id="$value['uid']_startTime"><a href="javascript:void(edit('{$value['uid']}_startTime','{$value['startTime']}'))">$value['startTime']</a></td>				<td width="2%">$value['stateMsg']</td>				<!--{/if}-->				<!--{if $value['state'] == 0 }-->				<td width="2%"><a href="javascript:void(deleteLine('{$value['uid']}'))">删除</a></td>				<!--{elseif $value['state'] == 3}-->				<td width="2%"><a href="javascript:void(confirmLine('{$value['uid']}'))">确认</a></br>				<a href="javascript:void(deleteLine('{$value['uid']}'))">删除</a></br></td>				<!--{else}-->				<td width="2%"></td>				<!--{/if}-->			</tr>			<!--{/loop}-->		</table>		<!--{else}-->		没有已成功完成的全服推送		<!--{/if}-->	</div></div><div id="addDiv" <!--{if !$deviceToken}-->style="display:none"<!--{/if}-->>	<form action="admincp.php?mod=op&act=push_execute" method="post" name="getaccount" enctype="multipart/form-data">		<input class="display:none;" type="hidden" value="" id="type" name="type" />		<!--<input class="display:none;" type="hidden" value="" id="type" name="type" />		推送帐号信息<input class="input-xxlarge focused" id="deviceToken" name="deviceToken" type="text" value="$deviceToken" /><br />		推送消息<input class="input-xlarge focused" id="message" name="message" type="text" value="" /><br />		<button type="button" class="btn btn-info" name="btn_set" onclick="checksubmit('push')">推送</button>-->		<table class="listTable" cellspacing=1 padding=0 style="width: 40%; text-align: center">			<tr>				<td>服务器名</td>				<td>					<!--{loop $servers $server $serverSettings}-->						$server					<!--{/loop}-->				</td>			</tr>			<tr><td>预计发送时间</td><td><input class="input-large focused" id="startTime" name="startTime" type="text" value="" /></td></tr>			<!--<tr><td>类型(数字，暂时不用管为0就好)</td><td><input class="input-large focused" id="configtype" name="configtype" type="text" value="0" maxlength=40 /></td></tr>-->			<tr><td>用户列表(服务器名_uid|服务器名_uid)</td>				<td id="content"><textarea class="input-xlarge" style="width: 600px;" id="txtlist" name="txtlist" rows="6"></textarea></td>				<!--<td><textarea class="input-xlarge" id="contents" name="contents" rows="6"></textarea></td>-->			</tr>			<tr><td>内容</td>				<td><textarea class="input-xlarge" id="contents" name="contents" rows="6" style="width: 600px;"></textarea></td></tr>			<tr><td></td><td>				<button type="button" class="btn btn-info" name="btn_set" onclick="checksubmit('add')">添加</button>				<button type="reset" class="btn">重置</button></td></tr>		</table>	</form></div><script type="text/javascript"></script><script type="text/javascript"> $("#startTime,#regStartTime,#regEndTime,#lastOnlineTime").datetimepicker();function showReward(buttonId,showId){	document.getElementById(buttonId).style.display = 'none';	document.getElementById(showId).style.display = 'block';}function changeType(){	if(document.getElementById('add').checked)	{		document.getElementById('manageDiv').style.display = 'none';		document.getElementById('addDiv').style.display = 'block';	}	if(document.getElementById('manage').checked)	{		document.getElementById('addDiv').style.display = 'none';		document.getElementById('manageDiv').style.display = 'block';	}}function isEmpty(value){	if(value == null || value ==""){		return true;	}else{		return false;	}}function checksubmit(type){	var startTime=$('#startTime').val();	var contents= $('#contents').val();	var txtlist = $('#txtlist').val();	contents=jQuery.trim(contents);	txtlist = jQuery.trim(txtlist);	startTime=jQuery.trim(startTime);	if(isEmpty(startTime)){		alert("<?php echo "please input start time";?>");		$("#startTime").focus();		return false;	}	if(isEmpty(contents)){		alert("<?php echo "please input contents";?>");		$("#contents").focus();		return false;	}	if(isEmpty(txtlist)){		alert("<?php echo "please input user list";?>");		$("#txtlist").focus();		return false;	}	var r=confirm("时间："+startTime+"\n\r发送列表："+txtlist+"\n\r发送内容："+contents);	if(r==true)	{		document.getElementById('type').value = type;		document.getaccount.submit();	}}function changeType(){	if(document.getElementById('manage').checked)	{		document.getElementById('addDiv').style.display = 'none';		document.getElementById('manageDiv').style.display = 'block';	}	if(document.getElementById('add').checked)	{		document.getElementById('manageDiv').style.display = 'none';		document.getElementById('addDiv').style.display = 'block';	}}function check(key){	var pattern = /[^0-9]/g;	if(pattern.test(key.value)){		alert('Please enter number');		$("#turn").val('');	}	return false;}function turnPage(){	var page = $("#turn").val();	getData(page);}function getData(page){	var url ='admincp.php?mod=op&act=push_execute&type=view&page='+page;	xmlHttp=getAjax();	xmlHttp.onreadystatechange = getAction;	xmlHttp.open("GET",url,true);	xmlHttp.send(null);}function getAction(){	right=document.getElementById('show');	if(xmlHttp.readyState==4){		if (xmlHttp.status==200){			if(xmlHttp.responseText.length == <?php echo MAIN_PAGE_LENGTH;?>){				showLogin();				return;			}			right.innerHTML=xmlHttp.responseText;			return;		}	}} function deleteLine(uid){	 if(confirm('是否确定删除'))	 {		 rmve(uid);	 } } function confirmLine(uid){	 if(confirm('是否确定信息\r\n注意：一旦确认，将无法修改!'))	 {		 confirmInfo(uid);	 } } function confirmInfo(uid){	 self.location = "admincp.php?mod=op&act=push_execute&type=confirm&uid="+uid; } function deleteAll(uid) {	 if(confirm('是否确定删除'))	 {		 rmveAll(uid);	 } } function rmveAll(uid){	 self.location = "admincp.php?mod=op&act=push_execute&type=deleteAll&uid="+uid; } function rmve(uid){	 self.location = "admincp.php?mod=op&act=push_execute&type=delete&uid="+uid; } var uuid = null; function edit(uid,now) {	 doClear();	 uuid = uid;	 var str='<form id="form1" style="margin:0">更新新数据: <input class="input-medium" name="num" type="text" id="new'+uid+'" value="'+now+'"><br/>当前:'+now+' <input type="button" id="savebtn" value="保存" onclick=save(new'+uid+')> <input type="button" id="cancelbtn" value="取消" onclick="rightinfo()"></form>';	 right=document.getElementById(uid);	 right.innerHTML=str;	 setDateFomate(); } function setDateFomate(){	 var objs=document.getElementsByTagName("input");	 for(i=0;i<objs.length;i++){		 var objId = objs[i].id.split('_');		 if(objId[1]=='startTime' || objId[1]=='regStartTime' || objId[1]=='regEndTime' || objId[1]=='lastOnlineTime')		 {			 $("#"+objs[i].id).datetimepicker();		 }	 } } var count = 0; function doClear(){	 count++;	 if(count>=2)	 {		 alert('一次只能修改一项,请把未完成的项保存');		 rightinfo();	 } } function save(num){	 if(uuid.indexOf('_type') != -1){		 str = num.value;		 var result=str.match(/^[0-9]+$/);		 if(result == null){			 alert("类型只能是数字");			 return false;		 }	 }	 self.location = 'admincp.php?mod=op&act=push_execute&type=modify&uid='+uuid+'&newDate='+num.value; } function rightinfo() {	 self.location = 'admincp.php?mod=op&act=push_execute'; }</script><!--{template footer}-->